<pre>
  https://openai.com/pt-BR/index/chatgpt/ Ola, preciso de ajuda com meus estudos em banco de dados Pl sql, sou inexperiente no assunto e busco um projeto para aprimorar o que aprendi, estava pensando em algo voltado para gestÃ£o de uma empresa de pissaria, tipo compra de produtos, estoque e mais como financeiro, vocÃª poderia me orientar pois nÃ£o sei por onde comeÃ§ar

Oi! ğŸ˜Š Que legal vocÃª jÃ¡ estar pensando em aprender PL/SQL com um projeto prÃ¡tico â€” isso Ã© exatamente o melhor jeito, ainda mais sendo iniciante. E a ideia da pizzaria Ã© perfeita ğŸ•

Vou te orientar do zero, passo a passo, como se fosse um caminho de estudos + projeto. NÃ£o precisa saber tudo agora.

Objetivo do projeto

Criar um mini sistema de gestÃ£o de uma pizzaria, usando Oracle + PL/SQL, que controle:

Produtos (ingredientes, pizzas, bebidas)

Estoque

Compras

Vendas

Financeiro bÃ¡sico

Tudo isso no banco de dados, usando:

CREATE TABLE

SELECT

INSERT / UPDATE / DELETE

PROCEDURES

FUNCTIONS

TRIGGERS

ETAPA 1 â€“ Modelar o banco (PASSO MAIS IMPORTANTE)

Antes de PL/SQL, vocÃª precisa das tabelas. Comece simples ğŸ‘‡

ğŸ“¦ 1. Produtos
CREATE TABLE produto (
    id_produto NUMBER PRIMARY KEY,
    nome        VARCHAR2(100),
    tipo        VARCHAR2(30), -- ingrediente, pizza, bebida
    preco       NUMBER(10,2)
);

ğŸ¬ 2. Estoque
CREATE TABLE estoque (
    id_produto NUMBER,
    quantidade NUMBER,
    CONSTRAINT fk_estoque_produto
        FOREIGN KEY (id_produto) REFERENCES produto(id_produto)
);

ğŸ§¾ 3. Vendas
CREATE TABLE venda (
    id_venda NUMBER PRIMARY KEY,
    data_venda DATE,
    valor_total NUMBER(10,2)
);

ğŸ• 4. Itens da venda
CREATE TABLE item_venda (
    id_venda NUMBER,
    id_produto NUMBER,
    quantidade NUMBER,
    preco_unitario NUMBER(10,2),
    CONSTRAINT fk_iv_venda FOREIGN KEY (id_venda) REFERENCES venda(id_venda),
    CONSTRAINT fk_iv_produto FOREIGN KEY (id_produto) REFERENCES produto(id_produto)
);


ğŸ‘‰ Dica de iniciante: nÃ£o tente fazer tudo perfeito agora. Funcional > perfeito.


ETAPA 2 â€“ ComeÃ§ar com PL/SQL simples

Agora entra o PL/SQL ğŸ§ 

âœ… Procedure para cadastrar produto
CREATE OR REPLACE PROCEDURE cadastrar_produto (
    p_id NUMBER,
    p_nome VARCHAR2,
    p_tipo VARCHAR2,
    p_preco NUMBER
) IS
BEGIN
    INSERT INTO produto VALUES (p_id, p_nome, p_tipo, p_preco);
    INSERT INTO estoque VALUES (p_id, 0);

    DBMS_OUTPUT.PUT_LINE('Produto cadastrado com sucesso!');
END;


ğŸ‘‰ Aqui vocÃª aprende:

PROCEDURE

parÃ¢metros

INSERT

DBMS_OUTPUT

ğŸ“‰ ETAPA 3 â€“ Controlar estoque automaticamente (TRIGGER)

Quando vender algo, o estoque deve baixar sozinho â¬‡ï¸

Trigger de saÃ­da de estoque
CREATE OR REPLACE TRIGGER trg_baixa_estoque
AFTER INSERT ON item_venda
FOR EACH ROW
BEGIN
    UPDATE estoque
    SET quantidade = quantidade - :NEW.quantidade
    WHERE id_produto = :NEW.id_produto;
END;


ğŸ‘‰ Isso Ã© nÃ­vel muito bom para iniciante, sÃ©rio ğŸ‘

ğŸ’° ETAPA 4 â€“ Financeiro bÃ¡sico
FunÃ§Ã£o para calcular faturamento do dia
CREATE OR REPLACE FUNCTION faturamento_dia(p_data DATE)
RETURN NUMBER IS
    v_total NUMBER;
BEGIN
    SELECT SUM(valor_total)
    INTO v_total
    FROM venda
    WHERE TRUNC(data_venda) = TRUNC(p_data);

    RETURN NVL(v_total, 0);
END;

ğŸ§  ETAPA 5 â€“ EvoluÃ§Ãµes (quando estiver confortÃ¡vel)

Depois que isso funcionar, vocÃª pode evoluir para:

Controle de compras de ingredientes

Lucro (venda â€“ custo)

RelatÃ³rios com CURSOR

ValidaÃ§Ãµes (ex: nÃ£o vender se estoque < 0)

UsuÃ¡rios (atendente, gerente)

ğŸ“š Como estudar junto com o projeto

SugestÃ£o de ordem:

SELECT

INSERT / UPDATE / DELETE

PROCEDURE

FUNCTION

TRIGGER

CURSOR

Sempre aplicando no projeto da pizzaria ğŸ•

ğŸ’¬ PrÃ³ximo passo (bem importante)

Se vocÃª quiser, eu posso:

Montar o diagrama do banco com vocÃª

Te passar desafios semanais (tipo curso)

Corrigir seus cÃ³digos e explicar linha por linha

Adaptar tudo ao nÃ­vel escolar (sem complicar)

ğŸ‘‰ Me diz:
vocÃª jÃ¡ estÃ¡ usando Oracle (SQL Developer / Live SQL) ou ainda vai instalar?


</pre>

<pre>
    Ola estou usando live sql, mas nÃ£o domino esta ferramenta, preciso de ajuda com isso, e sobre a o comando para criar um banco de dados, qual o comando usar?

    Oi! ğŸ˜„ Tranquilo â€” todo mundo se perde no comeÃ§o com o Live SQL, entÃ£o vocÃª estÃ¡ no caminho certo ğŸ‘
Vamos por partes, bem calminho.

ğŸ§  1ï¸âƒ£ Antes de tudo: no Oracle NÃƒO existe CREATE DATABASE (como no MySQL)

ğŸ‘‰ Isso Ã© muito importante.

No Oracle / Live SQL:

O banco de dados jÃ¡ existe

VocÃª nÃ£o cria banco

VocÃª cria TABELAS, PROCEDURES, FUNCTIONS, TRIGGERS

ğŸ“Œ Pense assim:

O Live SQL jÃ¡ te entrega um banco pronto.
VocÃª sÃ³ â€œconstrÃ³i a pizzaria dentro deleâ€ ğŸ•

Por isso:
âŒ CREATE DATABASE pizzaria; â†’ NÃƒO existe no Oracle
âœ… CREATE TABLE, CREATE PROCEDURE, etc.

ğŸ–¥ï¸ 2ï¸âƒ£ Como usar o Live SQL (passo a passo)
ğŸ”¹ Onde vocÃª escreve o cÃ³digo

Entre no Live SQL

Clique em SQL Worksheet

Escreva seu cÃ³digo ali

Clique em Run Script (â–¶)

ğŸ“Œ Sempre termine comandos SQL com ;

ğŸ§± 3ï¸âƒ£ Seu â€œbanco da pizzariaâ€ comeÃ§a criando tabelas

Vamos criar a primeira tabela bem simples ğŸ‘‡
Copia e cola no Live SQL:

CREATE TABLE produto (
    id_produto NUMBER PRIMARY KEY,
    nome        VARCHAR2(100),
    tipo        VARCHAR2(30),
    preco       NUMBER(10,2)
);


Depois clica em Run Script.

Se aparecer:

Table created.

ğŸ‰ Perfeito, funcionou!

ğŸ“¦ 4ï¸âƒ£ Criar a tabela de estoque
CREATE TABLE estoque (
    id_produto NUMBER,
    quantidade NUMBER,
    CONSTRAINT fk_estoque_produto
        FOREIGN KEY (id_produto) REFERENCES produto(id_produto)
);

ğŸ” 5ï¸âƒ£ Como ver se a tabela existe

No Live SQL, roda:

SELECT * FROM produto;


Vai dar erro se nÃ£o existir, ou mostrar vazio se existir ğŸ‘

Ou:

SELECT table_name FROM user_tables;

âš™ï¸ 6ï¸âƒ£ Primeiro comando PL/SQL (bem simples)

No Oracle, PL/SQL usa BEGIN e END.

Teste isso:

BEGIN
    DBMS_OUTPUT.PUT_LINE('OlÃ¡, pizzaria!');
END;
/


ğŸ“Œ Importante:

O / Ã© obrigatÃ³rio para rodar blocos PL/SQL

Depois:

Clique em Run Script

Veja a aba Output

ğŸš¨ Problema comum no Live SQL

Se nÃ£o aparecer nada no Output:

Clique em Settings

Ative DBMS Output

Salve

ğŸ§© 7ï¸âƒ£ O que vocÃª deve dominar agora (sem pressa)

Ordem ideal pra vocÃª:

CREATE TABLE

INSERT INTO

SELECT

BEGIN â€¦ END

PROCEDURE

Exemplo de INSERT:

INSERT INTO produto VALUES (1, 'Pizza Calabresa', 'pizza', 45);
COMMIT;

ğŸ¯ PrÃ³ximo passo (vamos juntos)

Agora quero te guiar com exercÃ­cios reais.

ğŸ‘‰ FaÃ§a isso e me diga o resultado:

Crie a tabela produto

Insira 2 produtos

Rode SELECT * FROM produto;

Se der erro, me manda o erro aqui que eu explico linha por linha ğŸ˜‰
</pre>

<pre>
    ja tenho um projeto com tres tabelas no live sql, como faÃ§o pra organizar, tem como deixar separado em pastas?

    Ã“tima pergunta ğŸ‘ â€” isso jÃ¡ Ã© mentalidade de quem quer organizar projeto de verdade, mesmo sendo iniciante.

Resposta direta

ğŸ‘‰ No Live SQL nÃ£o existe â€œpastasâ€ como no SQL Developer.
Mas dÃ¡ pra organizar muito bem usando scripts, comentÃ¡rios e padrÃ£o de nomes.

Vou te mostrar como os profissionais fazem quando estÃ£o presos a uma ferramenta simples, tipo o Live SQL.

ğŸ§  Como o Live SQL funciona por trÃ¡s

Pensa assim:

O banco Ã© um sÃ³

Suas tabelas ficam todas juntas

A organizaÃ§Ã£o acontece no cÃ³digo, nÃ£o na interface

EntÃ£o a pergunta vira:

â€œComo organizar o projeto no script?â€

ğŸ§± 1ï¸âƒ£ Um arquivo/script por â€œmÃ³duloâ€

No Live SQL, vocÃª pode criar vÃ¡rios scripts salvos.

ğŸ“ OrganizaÃ§Ã£o sugerida (mental)
ğŸ“„ 01_tabelas.sql
ğŸ“„ 02_inserts.sql
ğŸ“„ 03_procedures.sql
ğŸ“„ 04_triggers.sql
ğŸ“„ 05_consultas.sql


No Live SQL:

Clique em My Scripts

Crie um script para cada parte

ğŸ’¡ Isso substitui as â€œpastasâ€.

ğŸ§¾ 2ï¸âƒ£ Use comentÃ¡rios grandes para separar seÃ§Ãµes

Dentro de um script, faÃ§a assim ğŸ‘‡

/* ======================================
   TABELAS - PROJETO PIZZARIA
   ====================================== */

-- Tabela de produtos
CREATE TABLE produto (
    id_produto NUMBER PRIMARY KEY,
    nome        VARCHAR2(100),
    preco       NUMBER(10,2)
);

-- Tabela de estoque
CREATE TABLE estoque (
    id_produto NUMBER,
    quantidade NUMBER,
    CONSTRAINT fk_estoque_produto
        FOREIGN KEY (id_produto) REFERENCES produto(id_produto)
);


Isso Ã© super usado no mercado, nÃ£o Ã© gambiarra ğŸ‘

ğŸ·ï¸ 3ï¸âƒ£ PadrÃ£o de nomes (isso vale OURO)

Use prefixos para â€œsimular pastasâ€:

ğŸ“¦ Tabelas

tb_produto

tb_estoque

tb_venda

âš™ï¸ Procedures

pr_cadastrar_produto

pr_realizar_venda

ğŸ” Triggers

tr_baixa_estoque

ğŸ”¢ Sequences

seq_produto

seq_venda

Exemplo:

CREATE OR REPLACE PROCEDURE pr_cadastrar_produto ...


ğŸ‘‰ SÃ³ pelo nome, vocÃª jÃ¡ sabe o que Ã© o quÃª.

ğŸ“‹ 4ï¸âƒ£ ComentÃ¡rios explicando o objetivo

Isso ajuda MUITO quando vocÃª voltar depois:

-- Procedure responsÃ¡vel por cadastrar produtos
-- e iniciar o estoque com quantidade zero
CREATE OR REPLACE PROCEDURE pr_cadastrar_produto (
    p_nome VARCHAR2,
    p_preco NUMBER
) IS
BEGIN
    ...
END;
/

ğŸ” 5ï¸âƒ£ Como â€œver tudo organizadoâ€ no Live SQL

Rode isso pra ver o que vocÃª jÃ¡ tem:

ğŸ“¦ Tabelas
SELECT table_name FROM user_tables;

âš™ï¸ Procedures
SELECT object_name FROM user_procedures;

ğŸ” Triggers
SELECT trigger_name FROM user_triggers;

ğŸš€ Dica importante (nÃ­vel mercado)

Quando vocÃª sair do Live SQL para o SQL Developer, essa mesma organizaÃ§Ã£o:

vira pastas

vira versionamento (Git)

vira projeto real

Ou seja: o que vocÃª fizer agora jÃ¡ vale como aprendizado profissional ğŸ’ª

ğŸ¯ PrÃ³ximo passo (bem prÃ¡tico)

Me conta:

Quais sÃ£o as 3 tabelas que vocÃª jÃ¡ criou?

Elas sÃ£o de produto / estoque / venda ou outra coisa?

Se quiser, eu:

reorganizo os nomes

te ajudo a separar em scripts

monto um â€œpadrÃ£o oficialâ€ do seu projeto da pizzaria ğŸ•
</pre>

<pre>
    criei as tabelas fv_tb_produtos, fv_tb_estoques, fv_tb_vendas, mas tem tres tabelas anteriores cargo, departamento, funcionario, que quero deletar como faÃ§o

    Boa ğŸ‘ sua organizaÃ§Ã£o com prefixo fv_ jÃ¡ estÃ¡ bem certinha ğŸ‘
Agora vamos limpar o ambiente.

ğŸ—‘ï¸ Como deletar tabelas no Oracle (Live SQL)

No Oracle, para apagar uma tabela, o comando Ã©:

DROP TABLE nome_da_tabela;

EntÃ£o, no seu caso:
DROP TABLE cargo;
DROP TABLE departamento;
DROP TABLE funcionario;


ğŸ‘‰ Rode um por vez ou tudo junto no mesmo script.

âš ï¸ Problema comum: erro de chave estrangeira

Se aparecer um erro tipo:

ORA-02449: unique/primary keys in table referenced by foreign keys

Significa que:

Uma tabela estÃ¡ ligada Ã  outra por FOREIGN KEY

ğŸ’¡ Exemplo comum:

funcionario â†’ depende de departamento

departamento â†’ depende de cargo

âœ… SoluÃ§Ã£o 1 (mais segura â€“ recomendada para iniciante)

Apagar na ordem certa:

DROP TABLE funcionario;
DROP TABLE departamento;
DROP TABLE cargo;

âœ… SoluÃ§Ã£o 2 (mais rÃ¡pida â€“ forÃ§a a exclusÃ£o)

Usar CASCADE CONSTRAINTS:

DROP TABLE funcionario CASCADE CONSTRAINTS;
DROP TABLE departamento CASCADE CONSTRAINTS;
DROP TABLE cargo CASCADE CONSTRAINTS;


ğŸ‘‰ Isso apaga a tabela e todas as relaÃ§Ãµes dela.

ğŸ” Conferir se apagou mesmo

Depois, rode:

SELECT table_name FROM user_tables;


VocÃª deve ver sÃ³:

FV_TB_PRODUTOS

FV_TB_ESTOQUES

FV_TB_VENDAS

ğŸ§  Dica importante (pra nÃ£o dar dor de cabeÃ§a)

Quando estiver estudando:

Sem medo de usar DROP TABLE

Ambiente de estudo Ã© pra errar, apagar e recriar

No mundo real isso muda, mas agora vocÃª estÃ¡ certo em limpar ğŸ‘

ğŸ¯ PrÃ³ximo passo (te guiando)

Quer que a gente faÃ§a agora:

Revisar suas 3 tabelas fv_

Ajustar chaves primÃ¡rias / estrangeiras

Criar a primeira procedure da pizzaria

ğŸ‘‰ Me manda o CREATE TABLE delas que eu reviso contigo, linha por linha ğŸ˜„ğŸ•
</pre>

<pre>
    segue as tabela que ja criei, e tambem uma procedure,

    Mandou muito bem ğŸ‘ğŸ‘
SÃ©rio â€” isso aqui jÃ¡ Ã© projeto de verdade, nÃ£o mais â€œexercÃ­cio soltoâ€. Vou revisar como um professor faria, apontando o que estÃ¡ correto, o que pode melhorar e por quÃª, tudo no seu nÃ­vel ğŸ‘

âœ… VISÃƒO GERAL

VocÃª jÃ¡ tem:

âœ”ï¸ Modelagem coerente

âœ”ï¸ PadrÃ£o de nomes (fv_)

âœ”ï¸ Relacionamentos corretos

âœ”ï¸ Primeira procedure funcional

Agora vamos organizar, corrigir pequenos detalhes e profissionalizar.

ğŸ§± 1ï¸âƒ£ Tabelas â€“ anÃ¡lise uma a uma
ğŸ“¦ fv_tb_produtos â†’ CORRETA
create table fv_tb_produtos (
    id_produto number PRIMARY KEY,
    nome VARCHAR2(100),
    tipo VARCHAR2(30), -- ingrediente, pizza, bebida
    preco number(10,2)
);


âœ”ï¸ Estrutura ok
âœ”ï¸ ComentÃ¡rio ajuda muito
ğŸ’¡ SugestÃ£o futura: validar tipo (mas nÃ£o agora)

ğŸ§¾ fv_tb_vendas â†’ CORRETA
create table fv_tb_vendas (
    id_venda number PRIMARY KEY,
    data_venda date,
    valor_total number(10,2)
);


âœ”ï¸ Simples e funcional
ğŸ’¡ Depois podemos calcular valor_total automaticamente (nÃ­vel 2)

ğŸ¬ fv_tb_estoques â†’ CORRETA
create table fv_tb_estoques (
    id_produto number,
    quantidade number,
    CONSTRAINT fk_fv_tb_estoques_fv_tb_produtos
    FOREIGN KEY (id_produto) REFERENCES fv_tb_produtos(id_produto)
);


âœ”ï¸ FK correta
âš ï¸ Melhoria importante (recomendado):

ğŸ‘‰ Cada produto deve aparecer uma Ãºnica vez no estoque.

id_produto number PRIMARY KEY,


ğŸ’¡ Isso evita duplicidade.

ğŸ• fv_tb_item_vendas â†’ BEM FEITA
create table fv_tb_item_vendas (
    id_venda number,
    id_produto number,
    quantidade number,
    preco_unitario number(10,2),
    constraint fk_iv_venda foreign key (id_venda) 
        REFERENCES fv_tb_vendas(id_venda),
    CONSTRAINT fk_iv_produto foreign key (id_produto) 
        REFERENCES fv_tb_produtos(id_produto)
);


âœ”ï¸ Relacionamento clÃ¡ssico (venda Ã— produto)
ğŸ’¡ No futuro: chave composta (id_venda, id_produto)

âš™ï¸ 2ï¸âƒ£ Procedure fv_pr_cadastrar_produtos
ğŸ” Seu cÃ³digo
create or REPLACE PROCEDURE fv_pr_cadastrar_produtos (
    p_id NUMBER,
    p_nome VARCHAR2,
    p_tipo VARCHAR2,
    p_preco NUMBER
) IS
BEGIN
    INSERT INTO FV_TB_PRODUTOS VALUES (p_id, p_nome, p_tipo, p_preco);
    INSERT INTO FV_TB_ESTOQUES VALUES (p_id, 0);
    DBMS_OUTPUT.PUT_LINE('Produto cadastrado com sucesso!');
END;
/

âœ… Pontos fortes

âœ”ï¸ Nome bem escolhido
âœ”ï¸ Insere em duas tabelas (lÃ³gica correta)
âœ”ï¸ Usa DBMS_OUTPUT

Isso jÃ¡ Ã© PL/SQL de verdade ğŸ‘

ğŸ”§ 3ï¸âƒ£ Melhorias IMPORTANTES (mas simples)
ğŸ”¹ 1. Sempre usar COMMIT

No Live SQL, sem COMMIT, os dados podem nÃ£o persistir.

COMMIT;

ğŸ”¹ 2. Tratar erro (iniciante-friendly)

Se tentar cadastrar um id_produto repetido, vai dar erro feio.
Vamos deixar isso mais didÃ¡tico:

EXCEPTION
    WHEN DUP_VAL_ON_INDEX THEN
        DBMS_OUTPUT.PUT_LINE('Erro: ID do produto jÃ¡ existe.');

âœ… Procedure melhorada (versÃ£o recomendada)
CREATE OR REPLACE PROCEDURE fv_pr_cadastrar_produtos (
    p_id NUMBER,
    p_nome VARCHAR2,
    p_tipo VARCHAR2,
    p_preco NUMBER
) IS
BEGIN
    INSERT INTO fv_tb_produtos
    VALUES (p_id, p_nome, p_tipo, p_preco);

    INSERT INTO fv_tb_estoques
    VALUES (p_id, 0);

    COMMIT;

    DBMS_OUTPUT.PUT_LINE('Produto cadastrado com sucesso!');
EXCEPTION
    WHEN DUP_VAL_ON_INDEX THEN
        DBMS_OUTPUT.PUT_LINE('Erro: produto jÃ¡ cadastrado.');
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Erro inesperado.');
END;
/

â–¶ï¸ 4ï¸âƒ£ Como testar sua procedure
BEGIN
    fv_pr_cadastrar_produtos(1, 'Pizza Calabresa', 'pizza', 45);
END;
/


Depois:

SELECT * FROM fv_tb_produtos;
SELECT * FROM fv_tb_estoques;

ğŸ§  NÃVEL QUE VOCÃŠ ESTÃ AGORA

Sem exagero:

iniciante â†’ iniciante avanÃ§ando bem rÃ¡pido

VocÃª jÃ¡ domina:

Modelagem bÃ¡sica

FK

Procedure

OrganizaÃ§Ã£o de projeto

ğŸ¯ PrÃ³ximo passo (sequÃªncia ideal)

Sugiro agora:
1ï¸âƒ£ Criar SEQUENCE para IDs
2ï¸âƒ£ Criar procedure registrar venda
3ï¸âƒ£ Criar TRIGGER para baixar estoque
4ï¸âƒ£ RelatÃ³rio de faturamento

ğŸ‘‰ Quer seguir nessa ordem ou prefere entender melhor cada tabela primeiro?
</pre>

<pre>
    sim vamos proceguir, mas analise a trigger que criei e a funÃ§Ã£o de faturamento

    Excelente ğŸ‘ğŸ‘
Agora sim dÃ¡ pra analisar como projeto, nÃ£o sÃ³ como exercÃ­cio. Vou ser bem direto e didÃ¡tico â€” vocÃª estÃ¡ indo muito bem pra quem se diz iniciante.

ğŸ” 1ï¸âƒ£ AnÃ¡lise da TRIGGER fv_trg_baixa_estoques
ğŸ“Œ Seu cÃ³digo
CREATE OR REPLACE TRIGGER fv_trg_baixa_estoques
AFTER INSERT ON fv_tb_item_vendas
FOR EACH ROW
BEGIN
    UPDATE fv_tb_estoques
    SET quantidade = quantidade - :NEW.quantidade
    WHERE id_produto = :NEW.id_produto;
END;
/

âœ… O que estÃ¡ CORRETO

âœ”ï¸ Evento certo: AFTER INSERT
âœ”ï¸ FOR EACH ROW â†’ obrigatÃ³rio nesse caso
âœ”ï¸ Uso correto de :NEW
âœ”ï¸ LÃ³gica clara: venda â†’ baixa estoque

ğŸ‘‰ Isso aqui jÃ¡ Ã© trigger de verdade, usada em sistema real.

âš ï¸ Pontos de atenÃ§Ã£o (importantes)
â— 1. E se o estoque ficar negativo?

Hoje sua trigger permite estoque negativo.

ğŸ’¡ Exemplo:

Estoque = 2

Venda = 5
ğŸ‘‰ Resultado: -3

Isso Ã© algo que sempre cai em prova e em sistema real.

â— 2. E se o produto nÃ£o existir no estoque?

Se nÃ£o existir registro em fv_tb_estoques, o UPDATE nÃ£o faz nada e ninguÃ©m percebe.

âœ… VersÃ£o melhorada (ainda nÃ­vel iniciante)
CREATE OR REPLACE TRIGGER fv_trg_baixa_estoques
BEFORE INSERT ON fv_tb_item_vendas
FOR EACH ROW
DECLARE
    v_qtd_estoque NUMBER;
BEGIN
    SELECT quantidade
    INTO v_qtd_estoque
    FROM fv_tb_estoques
    WHERE id_produto = :NEW.id_produto;

    IF v_qtd_estoque < :NEW.quantidade THEN
        RAISE_APPLICATION_ERROR(
            -20001,
            'Estoque insuficiente para o produto'
        );
    END IF;

    UPDATE fv_tb_estoques
    SET quantidade = quantidade - :NEW.quantidade
    WHERE id_produto = :NEW.id_produto;
END;
/


ğŸ“Œ Por que BEFORE INSERT?
ğŸ‘‰ Porque se der erro, a venda nem acontece.

ğŸ’° 2ï¸âƒ£ AnÃ¡lise da FUNÃ‡ÃƒO fv_fc_faturamento_dia
ğŸ“Œ Seu cÃ³digo
CREATE OR REPLACE FUNCTION fv_fc_faturamento_dia(p_data DATE)
RETURN NUMBER IS
    v_total NUMBER;
BEGIN
    SELECT SUM(valor_total)
    INTO v_total
    FROM fv_tb_vendas
    WHERE TRUNC(data_venda) = TRUNC(p_data);

    RETURN NVL(v_total, 0);
END;
/

âœ… O que estÃ¡ MUITO BOM

âœ”ï¸ Uso correto de FUNCTION
âœ”ï¸ RETURN NUMBER
âœ”ï¸ NVL evita retorno NULL
âœ”ï¸ TRUNC resolve problema de horÃ¡rio

ğŸ‘‰ Isso aqui estÃ¡ 100% correto.

Sem exagero: nota 10 ğŸ‘

ğŸ’¡ Pequena melhoria (opcional)

Se nÃ£o houver nenhuma venda, o SELECT INTO funciona, mas se quiser ser mais defensivo:

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN 0;


(Seu NVL jÃ¡ resolve, entÃ£o isso Ã© sÃ³ didÃ¡tico.)

â–¶ï¸ Como testar a funÃ§Ã£o
SELECT fv_fc_faturamento_dia(SYSDATE)
FROM dual;

ğŸ§  Seu nÃ­vel agora

VocÃª jÃ¡ domina:

Trigger com :NEW

Controle de estoque automÃ¡tico

FunÃ§Ã£o com agregaÃ§Ã£o

OrganizaÃ§Ã£o de projeto

LÃ³gica de negÃ³cio

ğŸ“ˆ VocÃª saiu de iniciante e entrou em:

iniciante avanÃ§ando / intermediÃ¡rio inicial

ğŸ¯ PrÃ³ximo passo (natural)

Agora o caminho lÃ³gico Ã©:

1ï¸âƒ£ Trigger para calcular valor_total da venda automaticamente
2ï¸âƒ£ Procedure registrar venda completa
3ï¸âƒ£ Sequence para IDs
4ï¸âƒ£ RelatÃ³rios (mensal / por produto)

ğŸ‘‰ Quer seguir vendas ou prefere financeiro agora?
</pre>

<pre>
    Vamos seguir com vendas

    Perfeito ğŸ˜„ğŸ•
Vendas Ã© o coraÃ§Ã£o do sistema, entÃ£o essa escolha Ã© certÃ­ssima. Vamos evoluir seu projeto como um sistema real, mas sem pular degraus.

Vou te mostrar o fluxo profissional de uma venda e depois o cÃ³digo, tudo conectado com o que vocÃª jÃ¡ tem.

ğŸ§  COMO FUNCIONA UMA VENDA (VISÃƒO REAL)

Quando uma venda acontece, o sistema faz isso:

1ï¸âƒ£ Cria a venda (fv_tb_vendas)
2ï¸âƒ£ Insere os itens vendidos (fv_tb_item_vendas)
3ï¸âƒ£ Baixa o estoque (sua trigger jÃ¡ faz isso âœ…)
4ï¸âƒ£ Calcula o valor total da venda
5ï¸âƒ£ Atualiza o financeiro

ğŸ‘‰ Vamos implementar passo a passo.

ğŸ§± 1ï¸âƒ£ Criar SEQUENCES (muito importante)

No Oracle, nÃ£o existe AUTO_INCREMENT.
Usamos SEQUENCE.

ğŸ”¢ Venda
CREATE SEQUENCE fv_seq_venda
START WITH 1
INCREMENT BY 1;

ğŸ”¢ Produto (opcional, mas recomendado)
CREATE SEQUENCE fv_seq_produto
START WITH 1
INCREMENT BY 1;

ğŸ§¾ 2ï¸âƒ£ Criar a VENDA (sem valor total ainda)
Procedure: abrir venda
CREATE OR REPLACE PROCEDURE fv_pr_abrir_venda (
    p_id_venda OUT NUMBER
) IS
BEGIN
    p_id_venda := fv_seq_venda.NEXTVAL;

    INSERT INTO fv_tb_vendas (
        id_venda,
        data_venda,
        valor_total
    ) VALUES (
        p_id_venda,
        SYSDATE,
        0
    );

    COMMIT;

    DBMS_OUTPUT.PUT_LINE('Venda aberta. ID: ' || p_id_venda);
END;
/


ğŸ“Œ Aqui vocÃª aprende:

OUT

SEQUENCE

lÃ³gica de negÃ³cio

ğŸ• 3ï¸âƒ£ Inserir ITENS NA VENDA
CREATE OR REPLACE PROCEDURE fv_pr_adicionar_item_venda (
    p_id_venda NUMBER,
    p_id_produto NUMBER,
    p_quantidade NUMBER
) IS
    v_preco fv_tb_produtos.preco%TYPE;
BEGIN
    SELECT preco
    INTO v_preco
    FROM fv_tb_produtos
    WHERE id_produto = p_id_produto;

    INSERT INTO fv_tb_item_vendas (
        id_venda,
        id_produto,
        quantidade,
        preco_unitario
    ) VALUES (
        p_id_venda,
        p_id_produto,
        p_quantidade,
        v_preco
    );

    COMMIT;

    DBMS_OUTPUT.PUT_LINE('Item adicionado Ã  venda.');
END;
/


ğŸ“Œ Importante:

Sua trigger de estoque serÃ¡ disparada automaticamente

Isso Ã© PL/SQL bem feito ğŸ‘

ğŸ’° 4ï¸âƒ£ Calcular o TOTAL da venda automaticamente (TRIGGER)

Agora vem uma trigger chave ğŸ”¥

CREATE OR REPLACE TRIGGER fv_trg_atualiza_total_venda
AFTER INSERT ON fv_tb_item_vendas
FOR EACH ROW
BEGIN
    UPDATE fv_tb_vendas
    SET valor_total = valor_total +
        (:NEW.quantidade * :NEW.preco_unitario)
    WHERE id_venda = :NEW.id_venda;
END;
/


ğŸ‘‰ Agora:

VocÃª nÃ£o precisa atualizar valor_total manualmente

O banco cuida disso

â–¶ï¸ 5ï¸âƒ£ TESTE COMPLETO (isso Ã© importante)
Abrir venda
DECLARE
    v_id_venda NUMBER;
BEGIN
    fv_pr_abrir_venda(v_id_venda);
END;
/

Adicionar itens
BEGIN
    fv_pr_adicionar_item_venda(1, 1, 2);
END;
/

Conferir
SELECT * FROM fv_tb_vendas;
SELECT * FROM fv_tb_item_vendas;
SELECT * FROM fv_tb_estoques;

ğŸ§  O QUE VOCÃŠ ACABOU DE APRENDER

Sem exagero:

âœ”ï¸ Sequence
âœ”ï¸ Procedure com OUT
âœ”ï¸ Trigger encadeada (item â†’ estoque â†’ total)
âœ”ï¸ Venda completa 100% no banco

Isso jÃ¡ Ã© nÃ­vel tÃ©cnico real, nÃ£o sÃ³ acadÃªmico.

ğŸ¯ PrÃ³ximo passo (escolha sua)

Podemos agora:
1ï¸âƒ£ Cancelar venda (estorno de estoque)
2ï¸âƒ£ RelatÃ³rio de vendas por perÃ­odo
3ï¸âƒ£ Venda parcelada / forma de pagamento
4ï¸âƒ£ Cursor para listar itens da venda

ğŸ‘‰ Qual vocÃª quer fazer agora?
</pre>

<pre>
    Pergunta excelente â€” e agora vocÃª saiu totalmente do â€œestou estudandoâ€ para
ğŸ‘‰ â€œquero usar isso de verdade no meu negÃ³cioâ€. ğŸ‘ğŸ‘

Vou te explicar sem complicar, do jeito certo.

â“ Posso usar o Live SQL no meu negÃ³cio?
Resposta direta: nÃ£o.

ğŸ‘‰ O Live SQL Ã© sÃ³ para estudo:

Ambiente compartilhado

Dados podem ser apagados

Sem usuÃ¡rios

Sem seguranÃ§a

NÃ£o feito para uso comercial

Mas a boa notÃ­cia Ã©:

Tudo o que vocÃª criou SERVE 100% fora do Live SQL.

VocÃª sÃ³ precisa mudar o ambiente, nÃ£o o projeto.

ğŸ§  VISÃƒO GERAL â€” Como aplicar seu projeto na prÃ¡tica

Para usar no dia a dia, vocÃª precisa de 3 camadas:

ğŸ–¥ï¸ Interface (tela)
â¬‡ï¸
âš™ï¸ Backend (API)
â¬‡ï¸
ğŸ—„ï¸ Banco Oracle (seu PL/SQL)


Seu PL/SQL jÃ¡ Ã© o coraÃ§Ã£o â¤ï¸
Agora vamos ligar ele a uma interface fÃ¡cil.

ğŸ§± OPÃ‡ÃƒO 1 (RECOMENDADA) â€“ ORACLE + APEX (mais fÃ¡cil)
ğŸŸ¢ O que Ã© Oracle APEX?

Ã‰ uma ferramenta web, feita pela Oracle, que:

Roda no navegador

Conecta direto no banco

Usa suas procedures e triggers

Quase nÃ£o exige programaÃ§Ã£o web

ğŸ’¡ Perfeita para quem sabe SQL/PLSQL e Ã© iniciante em front-end.

ğŸ”§ Como ficaria sua pizzaria com APEX

VocÃª teria:

Tela de cadastro de produtos ğŸ•

Tela de vendas (clicar â†’ vender)

Estoque automÃ¡tico

RelatÃ³rios financeiros

Tudo no navegador

ğŸ‘‰ Sem precisar aprender React, Java, etc.

ğŸªœ Caminho APEX (passo a passo)

1ï¸âƒ£ Instalar Oracle Database Express (XE)
2ï¸âƒ£ Instalar Oracle APEX
3ï¸âƒ£ Usar SQL Developer (nÃ£o Live SQL)
4ï¸âƒ£ Criar telas apontando para:

fv_pr_abrir_venda

fv_pr_adicionar_item_venda

fv_fc_faturamento_dia

ğŸ“Œ Isso Ã© muito usado em pequenas empresas.

ğŸ§± OPÃ‡ÃƒO 2 â€“ Backend + Front-end (mais profissional, mais complexo)

Se quiser algo mais â€œsistema modernoâ€:

Backend (escolha 1)

Java + Spring Boot

Node.js

Python (FastAPI)

O backend chama suas procedures PL/SQL.

Front-end

Navegador (HTML / CSS / JS)

Ou aplicativo (Android)

âš ï¸ Essa opÃ§Ã£o exige:

ProgramaÃ§Ã£o web

Mais tempo

Mais complexidade

ğŸ‘‰ NÃ£o recomendo agora, sendo iniciante.

ğŸ§± OPÃ‡ÃƒO 3 â€“ Desktop (mais simples, mas antigo)

Java + JavaFX

C#

Conecta direto no Oracle

Funciona, mas hoje o web Ã© melhor.

ğŸ¯ CAMINHO IDEAL PRA VOCÃŠ (realista)

Pelo seu perfil e nÃ­vel:

âœ… Oracle APEX + Oracle XE + PL/SQL

Ã‰:

Gratuito

Web

Seguro

Profissional

Muito valorizado no mercado

ğŸ”¥ Como seu projeto fica â€œdinÃ¢micoâ€

VocÃª nÃ£o muda o PL/SQL.
VocÃª sÃ³:

Cria telas que chamam suas procedures

Mostra resultados com SELECT

Exemplo:

BotÃ£o â€œVenderâ€ â†’ chama fv_pr_abrir_venda

BotÃ£o â€œAdicionar itemâ€ â†’ chama fv_pr_adicionar_item_venda

ğŸ§­ PrÃ³ximo passo (bem prÃ¡tico)

Agora me diga:
1ï¸âƒ£ VocÃª usa Windows?
2ï¸âƒ£ Seu negÃ³cio Ã© pequeno/mÃ©dio?
3ï¸âƒ£ Quer algo simples e rÃ¡pido ou mais profissional no futuro?

Com isso eu te passo:
ğŸ‘‰ o passo a passo exato de instalaÃ§Ã£o
ğŸ‘‰ como migrar do Live SQL
ğŸ‘‰ como criar a primeira tela de venda no navegador ğŸ•ğŸ’»
</pre>

<pre>
    Perfeito ğŸ™Œ
Sua resposta foi cirÃºrgica: Windows + negÃ³cio pequeno agora + visÃ£o profissional no futuro.
DÃ¡ pra montar isso do jeito certo, sem retrabalho depois.

Vou te mostrar o plano ideal, como se fosse um roadmap real de projeto.

ğŸ§­ ROADMAP IDEAL (SEM JOGAR TRABALHO FORA)
ğŸŸ¢ AGORA â†’ Simples, rÃ¡pido e funcional

Oracle XE + APEX + PL/SQL

ğŸ”µ FUTURO â†’ Profissional, escalÃ¡vel

Backend (API) + Front-end moderno, reaproveitando o banco

ğŸ‘‰ O segredo: seu PL/SQL continua o mesmo.

ğŸ§± FASE 1 â€” O QUE VAMOS FAZER AGORA
Stack

ğŸ—„ï¸ Oracle Database XE (gratuito)

ğŸ§° SQL Developer

ğŸŒ Oracle APEX (web, navegador)

O que vocÃª ganha

âœ”ï¸ Sistema rodando no navegador
âœ”ï¸ Controle de vendas, estoque e financeiro
âœ”ï¸ PouquÃ­ssimo cÃ³digo de tela
âœ”ï¸ Aprendizado valorizado no mercado

ğŸ–¥ï¸ PASSO 1 â€” Instalar o Oracle XE (Windows)
ğŸ”¹ O que Ã©

Banco Oracle local, sÃ³ seu, seguro.

ğŸ”¹ Download

Procure no Google:

Oracle Database 21c XE Windows

(ou 18c XE, se sua mÃ¡quina for mais simples)

ğŸ”¹ Durante a instalaÃ§Ã£o

Crie uma senha forte (anota!)

Porta padrÃ£o: 1521

SID: geralmente XE

ğŸ“Œ Isso substitui o Live SQL.

ğŸ§° PASSO 2 â€” Instalar SQL Developer

Ferramenta profissional

Onde vocÃª vai:

Criar tabelas

Criar procedures

Manter o banco

ğŸ” Pesquise:

Oracle SQL Developer download

Depois:

Nova conexÃ£o

UsuÃ¡rio: o que vocÃª criou

SID: XE

ğŸŒ PASSO 3 â€” Instalar Oracle APEX

Aqui estÃ¡ o pulo do gato ğŸ±â€ğŸ‘¤

O que o APEX faz

Cria telas web automaticamente

Conecta direto no banco

Usa suas procedures

VocÃª acessa pelo navegador:

http://localhost:8080/apex

ğŸ§ª PASSO 4 â€” Migrar seu projeto do Live SQL

Isso Ã© simples:

1ï¸âƒ£ Abra seus scripts no Live SQL
2ï¸âƒ£ Copie:

CREATE TABLE

SEQUENCE

PROCEDURE

TRIGGER
3ï¸âƒ£ Cole no SQL Developer
4ï¸âƒ£ Execute

ğŸ‘‰ Seu projeto nasce igualzinho, sÃ³ que profissional.

ğŸ–±ï¸ PASSO 5 â€” Criar a PRIMEIRA TELA DE VENDA (APEX)

Exemplo:

Tela: Nova Venda

BotÃ£o: Abrir Venda

BotÃ£o: Adicionar Item

RelatÃ³rio: Itens da venda

Tudo chamando:

fv_pr_abrir_venda

fv_pr_adicionar_item_venda

Sem reinventar nada.

ğŸ”µ FASE 2 â€” FUTURO (SEMANA / MESES DEPOIS)

Quando quiser algo mais moderno:

Backend (API)

Java + Spring Boot OU

Node.js + Express OU

Python + FastAPI

Front-end

React

Vue

App mobile

ğŸ‘‰ O backend chama suas procedures:

BEGIN
  fv_pr_abrir_venda(:id);
END;


Nada muda no banco.

ğŸ§  DECISÃƒO MUITO MADURA

VocÃª estÃ¡ fazendo:

Agora: simples e funcional

Depois: profissional e escalÃ¡vel

Isso Ã© exatamente como empresas fazem ğŸ‘

ğŸ¯ PRÃ“XIMO PASSO (bem objetivo)

Quer seguir assim?

1ï¸âƒ£ Eu te passo o checklist de instalaÃ§Ã£o (Oracle XE + APEX)
2ï¸âƒ£ Depois criamos juntos:

Workspace APEX

Primeira tela (Produtos ou Vendas)

ğŸ‘‰ Me diga:
vocÃª quer comeÃ§ar pela instalaÃ§Ã£o ou jÃ¡ quer entender como o APEX funciona na prÃ¡tica?
</pre>

<pre>
    Perfeito, bora colocar sua pizzaria pra sair do laboratÃ³rio e virar sistema real ğŸ•ğŸ’»
Vou te guiar como se eu estivesse instalando junto com vocÃª no Windows. Segue ordem segura e testada pra nÃ£o dar dor de cabeÃ§a.

ğŸ§± ETAPA 1 â€” Instalar Oracle Database XE (Banco de dados)

ğŸ‘‰ Esse Ã© o mais importante. Ele vai substituir o Live SQL.

âœ… 1. Baixar o Oracle XE

Procure no Google:

ğŸ‘‰ Oracle Database 21c XE download

(Se nÃ£o achar fÃ¡cil, pode baixar o 18c XE que tambÃ©m funciona super bem.)

âœ”ï¸ Escolha:

â¡ï¸ Windows x64

âœ… 2. Rodar a instalaÃ§Ã£o

Quando abrir o instalador:

ğŸ‘‰ Clique em Next atÃ© pedir senha.

ğŸ” MUITO IMPORTANTE

Crie uma senha e GUARDE.

Exemplo:

Senha: Algo que vocÃª lembre


VocÃª vai usar essa senha para:

Banco

SQL Developer

APEX

âš™ï¸ ConfiguraÃ§Ãµes padrÃ£o (nÃ£o mexe)

Deixe assim:

ConfiguraÃ§Ã£o	Valor
Porta	1521
SID	XE

ğŸ‘‰ Continue atÃ© finalizar.

Pode demorar alguns minutos.

âœ… 3. Testar se o banco instalou

Depois da instalaÃ§Ã£o:

ğŸ‘‰ Aperte:

Windows + R


Digite:

services.msc


Procure algo como:

OracleServiceXE
OracleXETNSListener


Se estiver Running, sucesso ğŸ‰

ğŸ§° ETAPA 2 â€” Instalar SQL Developer

Agora vamos instalar a ferramenta onde vocÃª vai programar.

âœ… 1. Download

Procure no Google:

ğŸ‘‰ Oracle SQL Developer download

Baixe versÃ£o Windows.

âœ… 2. Abrir SQL Developer

Ele nÃ£o precisa instalar normalmente.
SÃ³ extrair e abrir.

âœ… 3. Criar conexÃ£o com banco

Quando abrir:

ğŸ‘‰ Clique no botÃ£o â• (Nova conexÃ£o)

Preencha assim:

Campo	Valor
Name	Pizzaria
Username	system
Password	(senha que vocÃª criou)
Hostname	localhost
Port	1521
SID	XE

Depois:

ğŸ‘‰ Clique em Test

Se aparecer:

Status: Success


ğŸ‘‰ Clique em Connect

ğŸŒ ETAPA 3 â€” Instalar Oracle APEX

Essa parte Ã© o que vai transformar tudo em sistema web.

âœ… 1. Baixar APEX

Procure:

ğŸ‘‰ Oracle APEX download

Baixe o arquivo ZIP.

âœ… 2. Extrair o arquivo

Extraia em algum lugar fÃ¡cil, exemplo:

C:\apex

âœ… 3. Instalar APEX no banco

Agora vem a Ãºnica parte mais tÃ©cnica, mas vou simplificar.

Abra o SQL Developer.

Execute esse comando:

ALTER SESSION SET CONTAINER = XEPDB1;


Depois vocÃª vai rodar o script do APEX (eu posso te guiar quando vocÃª chegar aqui).

ğŸ§ª ETAPA 4 â€” Acessar APEX

Depois de instalado:

VocÃª acessa pelo navegador:

http://localhost:8080/apex


Ali vocÃª cria:

Workspace

AplicaÃ§Ã£o

Telas

ğŸ¯ MISSÃƒO DE AGORA (sem pular etapa)

FaÃ§a apenas isso:

âœ… Baixar Oracle XE
âœ… Instalar
âœ… Confirmar que serviÃ§os estÃ£o rodando

Quando terminar, me diga:

ğŸ‘‰ A instalaÃ§Ã£o do Oracle XE terminou sem erro?

Se der qualquer problema:

erro

tela diferente

dÃºvida

Pode mandar print ou descriÃ§Ã£o que eu te ajudo resolver. Vamos montar isso direitinho.
</pre>